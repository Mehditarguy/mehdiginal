// ULTIMATE PREMIUM MEHDIGINAL PORTFOLIO - YOUTUBE ERROR 153 FIXED VERSION

// Enhanced application data with ALL required projects and complete client restoration
const appData = {
  "branding": {
    "name": "Mehdiginal",
    "tagline": "Premium Video Editor & Creative Director",
    "hero_image": "https://drive.google.com/thumbnail?id=1SxYsr-WFxltpxKcK7IZH1Fknfxnb2sV9&sz=w400",
    "skills": [
      {"name": "After Effects", "level": 95, "years": 4, "icon": "üé¨"},
      {"name": "Premiere Pro", "level": 90, "years": 4, "icon": "‚úÇÔ∏è"}, 
      {"name": "DaVinci Resolve", "level": 85, "years": 3, "icon": "üé®"},
      {"name": "Blender", "level": 80, "years": 2, "icon": "üé≠"},
      {"name": "Cinema 4D", "level": 85, "years": 3, "icon": "üé¨"},
      {"name": "Photoshop", "level": 88, "years": 4, "icon": "üé®"},
      {"name": "Illustrator", "level": 82, "years": 3, "icon": "üé®"},
      {"name": "Final Cut Pro", "level": 75, "years": 2, "icon": "‚úÇÔ∏è"},
      {"name": "Figma", "level": 78, "years": 2, "icon": "üé®"}
    ],
    "stats": {
      "experience": "4+ Years",
      "projects": "300+ Projects", 
      "views": "200M+ Views",
      "clients": "45+ Clients",
      "awards": "12+ Awards",
      "satisfaction": "99% Client Satisfaction"
    },
    "showreel": "https://vimeo.com/1112777026"
  },
  "projects": [
    {
      "id": "motion-graphics-collection",
      "title": "Motion Graphics Collection",
      "category": "Motion Graphics & Animation",
      "categoryColor": "purple",
      "description": "A showcase of dynamic motion graphics and animation work featuring vibrant visuals, smooth transitions, and creative storytelling.",
      "cover": "https://user-gen-media-assets.s3.amazonaws.com/gpt4o_images/c8b74fda-fda2-475f-9706-930437cdf507.png",
      "featured": true,
      "duration": "Various",
      "year": "2024-2025",
      "tags": ["Motion Graphics", "Animation", "After Effects", "Cinema 4D"],
      "techStack": ["After Effects", "Cinema 4D", "Illustrator", "Photoshop"],
      "videos": [
        {
          "platform": "YouTube",
          "url": "https://youtube.com/shorts/jkadZH7J4BY",
          "title": "Motion Graphics Reel 1",
          "type": "reel"
        },
        {
          "platform": "YouTube", 
          "url": "https://youtube.com/shorts/-kQQuwkFtBY",
          "title": "Motion Graphics Reel 2", 
          "type": "reel"
        },
        {
          "platform": "YouTube",
          "url": "https://youtube.com/shorts/2OPuItJ34-w",
          "title": "Motion Graphics Reel 3",
          "type": "reel"
        },
        {
          "platform": "YouTube",
          "url": "https://youtube.com/shorts/TmdetcllGjQ", 
          "title": "Motion Graphics Reel 4",
          "type": "reel"
        }
      ],
      "client": {
        "name": "Mehdiginal Studio",
        "avatar": "https://drive.google.com/thumbnail?id=1SxYsr-WFxltpxKcK7IZH1Fknfxnb2sV9&sz=w120"
      },
      "results": {
        "total_views": "500K+",
        "engagement_rate": "18%",
        "client_projects": "20+"
      },
      "testimonial": "Exceptional motion graphics work that brings ideas to life with stunning visual appeal and technical precision."
    },
    {
      "id": "ain-atlass-x-mge",
      "title": "Ain Atlass √ó MGE", 
      "category": "Branding & Reels",
      "categoryColor": "orange",
      "description": "Complete brand video package with multiple social media formats that elevated brand presence and engagement across all platforms.",
      "cover": "https://drive.google.com/thumbnail?id=1Ju3G-ReBwRT2UtbWwCvP-IWwJP3NYRJh&sz=w800",
      "featured": true,
      "duration": "2 weeks",
      "year": "2024",
      "tags": ["Branding", "Social Media", "Reels"],
      "techStack": ["After Effects", "Premiere Pro", "Photoshop"],
      "beforeAfter": {
        "before": "https://user-gen-media-assets.s3.amazonaws.com/gpt4o_images/0352aab0-1a3f-4ada-8d2f-091cd1218d0a.png",
        "after": "https://user-gen-media-assets.s3.amazonaws.com/gpt4o_images/d69ccc88-245b-43f3-b3df-4afe368dd3df.png"
      },
      "videos": [
        {
          "platform": "Instagram",
          "url": "https://www.instagram.com/reel/DLxaAfsoPYU/?utm_source=ig_web_copy_link&igsh=MzRlODBiNWFlZA==",
          "title": "Brand Showcase Reel",
          "type": "reel"
        }
      ],
      "client": {
        "name": "Chadidi",
        "avatar": "https://drive.google.com/thumbnail?id=1qPGW6C9vFmpd5TNrcAsWASLgDHlqzMwM&sz=w120"
      },
      "results": {
        "views": "150K+",
        "engagement": "+25%",
        "followers": "+500"
      },
      "testimonial": "Mehdiginal transformed our brand presence with incredible creativity and attention to detail."
    },
    {
      "id": "freefire-event-2025",
      "title": "Free Fire Event 2025",
      "category": "Event Coverage",
      "categoryColor": "teal",
      "description": "Complete event documentation with vlogs and highlights, capturing the excitement and energy of the gaming tournament.",
      "cover": "https://drive.google.com/thumbnail?id=1xn_oykBe_KgCkFrHq6vr7XJ9ao54-7xH&sz=w800",
      "featured": true,
      "duration": "1 month",
      "year": "2025",
      "tags": ["Gaming", "Events", "Vlogs"],
      "techStack": ["Premiere Pro", "After Effects", "DaVinci Resolve"],
      "videos": [
        {
          "platform": "YouTube",
          "url": "https://youtu.be/_UX1WYRv2q0",
          "title": "Event Vlog 1",
          "type": "video"
        },
        {
          "platform": "YouTube",
          "url": "https://youtu.be/RJ2ZN3o8G6w",
          "title": "Event Vlog 2",
          "type": "video"
        },
        {
          "platform": "YouTube",
          "url": "https://youtube.com/shorts/gx2tLWwGwlI",
          "title": "Sakura Mlagi",
          "type": "reel"
        },
        {
          "platform": "YouTube",
          "url": "https://youtube.com/shorts/IR0PTiCTgeY",
          "title": "Modox",
          "type": "reel"
        },
        {
          "platform": "YouTube",
          "url": "https://youtube.com/shorts/JgOIrnv1cdo",
          "title": "Characters",
          "type": "reel"
        },
        {
          "platform": "YouTube",
          "url": "https://youtube.com/shorts/9ncH-ckbbQI",
          "title": "Run",
          "type": "reel"
        },
        {
          "platform": "YouTube",
          "url": "https://youtube.com/shorts/chf38YWCb5s",
          "title": "Standing",
          "type": "reel"
        }
      ],
      "client": {
        "name": "Chadidi",
        "avatar": "https://drive.google.com/thumbnail?id=1qPGW6C9vFmpd5TNrcAsWASLgDHlqzMwM&sz=w120"
      },
      "results": {
        "total_views": "6M+",
        "subscriber_growth": "+10K"
      },
      "testimonial": "The event coverage exceeded all expectations. Professional quality that rivals major networks."
    },
    {
      "id": "freefire-world-series",
      "title": "Free Fire World Series (Global Finals 2024)",
      "category": "Championship Coverage",
      "categoryColor": "red",
      "description": "Official tournament coverage with highlights and behind-the-scenes content for the biggest gaming championship of the year.",
      "cover": "https://i.ibb.co/29qNHgC/cover.jpg",
      "featured": true,
      "duration": "3 weeks",
      "year": "2024",
      "tags": ["Esports", "Tournament", "Global"],
      "techStack": ["Premiere Pro", "After Effects", "DaVinci Resolve", "Cinema 4D"],
      "videos": [
        {
          "platform": "YouTube",
          "url": "https://www.youtube.com/watch?v=OG9JZu4rmD4",
          "title": "Main Event Vlog",
          "type": "video"
        },
        {
          "platform": "YouTube",
          "url": "https://youtube.com/shorts/XFeNs9bR58Y",
          "title": "Sonia",
          "type": "reel"
        },
        {
          "platform": "YouTube",
          "url": "https://youtube.com/shorts/-WESZ5SUpkc",
          "title": "Trip to Brazil",
          "type": "reel"
        },
        {
          "platform": "YouTube",
          "url": "https://youtube.com/shorts/aoTsbUX_0rU",
          "title": "Nubro",
          "type": "reel"
        },
        {
          "platform": "YouTube",
          "url": "https://youtube.com/shorts/43dALQ8_hPM",
          "title": "Alok",
          "type": "reel"
        },
        {
          "platform": "YouTube",
          "url": "https://youtube.com/shorts/ViCdQubjckA",
          "title": "Congrats",
          "type": "reel"
        }
      ],
      "client": {
        "name": "Chadidi", 
        "avatar": "https://drive.google.com/thumbnail?id=1qPGW6C9vFmpd5TNrcAsWASLgDHlqzMwM&sz=w120"
      },
      "results": {
        "total_views": "10M+",
        "global_reach": "50+ Countries"
      },
      "testimonial": "World-class production that elevated our tournament to international standards."
    }
  ],
  "clients": [
    {
      "id": "chadidi",
      "name": "Chadidi",
      "industry": "Gaming & Entertainment",
      "avatar": "https://drive.google.com/thumbnail?id=1qPGW6C9vFmpd5TNrcAsWASLgDHlqzMwM&sz=w120",
      "social": {
        "instagram": "https://www.instagram.com/chadidi.yt/",
        "youtube": "https://www.youtube.com/@ChadidiGamer1"
      },
      "stats": {
        "videos": "200+",
        "reels": "150+",
        "views": "150M+",
        "subscribers": "2M+",
        "collaboration_duration": "2+ Years"
      },
      "testimonial": "Mehdiginal transformed our content strategy with incredible video editing skills and creative vision.",
      "items": [
        {
          "type": "video",
          "title": "Main Event Vlog",
          "url": "https://www.youtube.com/watch?v=OG9JZu4rmD4"
        },
        {
          "type": "video",
          "title": "Event Vlog 1",
          "url": "https://youtu.be/_UX1WYRv2q0"
        },
        {
          "type": "video",
          "title": "Event Vlog 2",
          "url": "https://youtu.be/RJ2ZN3o8G6w"
        },
        {
          "type": "reel",
          "title": "Alok",
          "url": "https://youtube.com/shorts/43dALQ8_hPM"
        },
        {
          "type": "reel",
          "title": "Sonia",
          "url": "https://youtube.com/shorts/XFeNs9bR58Y"
        },
        {
          "type": "reel",
          "title": "Trip to Brazil",
          "url": "https://youtube.com/shorts/-WESZ5SUpkc"
        },
        {
          "type": "reel",
          "title": "Nubro",
          "url": "https://youtube.com/shorts/aoTsbUX_0rU"
        },
        {
          "type": "reel",
          "title": "Congrats",
          "url": "https://youtube.com/shorts/ViCdQubjckA"
        }
      ]
    },
    {
      "id": "bilal-sedrati",
      "name": "Bilal Sedrati",
      "industry": "Lifestyle & Food",
      "avatar": "https://drive.google.com/thumbnail?id=1ZZeCGMQSB0-q3xd32JvDki2xEoFWiG43&sz=w120",
      "stats": {
        "videos": "50+",
        "reels": "30+",
        "views": "10M+",
        "subscribers": "500K+",
        "collaboration_duration": "1+ Year"
      },
      "testimonial": "Professional, creative, and always delivers beyond expectations. Highly recommended!",
      "items": [
        {
          "type": "reel",
          "title": "Food Ad",
          "url": "https://youtube.com/shorts/KwAVi9MY7hM"
        },
        {
          "type": "reel",
          "title": "Fun Video 1",
          "url": "https://youtube.com/shorts/k_2WGlXncF4"
        },
        {
          "type": "reel",
          "title": "Fun Video 2",
          "url": "https://youtube.com/shorts/ljDi-WWWlPs"
        },
        {
          "type": "video",
          "title": "Aqua Fun",
          "url": "https://vimeo.com/1117968177"
        }
      ]
    },
    {
      "id": "energy-plus",
      "name": "Energy Plus (Gym)",
      "industry": "Fitness & Health",
      "avatar": "https://drive.google.com/thumbnail?id=1ElXHymEJQ8YSOBVl_SpjKlvMjqPwcxKM&sz=w120",
      "stats": {
        "videos": "25+",
        "reels": "15+",
        "views": "5M+",
        "members": "+1000",
        "collaboration_duration": "6 Months"
      },
      "testimonial": "Incredible work that helped us reach thousands of new fitness enthusiasts!",
      "items": [
        {
          "type": "reel",
          "title": "Gym Promotional Reel",
          "url": "https://youtube.com/shorts/WcYo5-tjP6Y"
        }
      ]
    },
    {
      "id": "thejawadkhalifa",
      "name": "The Jawad Khalifa",
      "industry": "Finance & Education",
      "avatar": "https://drive.google.com/thumbnail?id=1ZBytb0CbIiGaICzUjTxxiI6i4xu5Xks4&sz=w120",
      "stats": {
        "videos": "80+",
        "reels": "40+",
        "views": "25M+",
        "students": "10K+",
        "collaboration_duration": "1.5 Years"
      },
      "testimonial": "Outstanding video production that makes complex financial topics accessible and engaging.",
      "items": [
        {
          "type": "reel",
          "title": "Not a Crypto Expert",
          "url": "https://vimeo.com/1112777026"
        },
        {
          "type": "reel",
          "title": "Inflation Isn't Your Friend",
          "url": "https://vimeo.com/1118297786"
        },
        {
          "type": "reel",
          "title": "Simplest Plan Ever",
          "url": "https://vimeo.com/1112776971"
        },
        {
          "type": "reel",
          "title": "1000 to 100000 Dollar",
          "url": "https://vimeo.com/1112776907"
        },
        {
          "type": "reel",
          "title": "A Haircut",
          "url": "https://vimeo.com/1112776924"
        }
      ]
    }
  ],
  "contact": {
    "email": "mahditarguy3@gmail.com",
    "phone": "+212707900546",
    "location": "Professional Studio, Creative District",
    "timezone": "GMT+1",
    "response_time": "Within 24 hours",
    "social": {
      "instagram": "https://instagram.com/mehdiginal",
      "youtube": "https://youtube.com/@mehdiginal", 
      "vimeo": "https://vimeo.com/mehdiginal",
      "linkedin": "https://linkedin.com/in/mehdiginal",
      "twitter": "https://twitter.com/mehdiginal"
    },
    "services": [
      "Video Editing & Post-Production",
      "Motion Graphics & Animation", 
      "Brand Video Creation",
      "Social Media Content",
      "Event Documentation",
      "Creative Direction"
    ]
  }
};

// Application state
let currentView = 'home';
let currentProject = null;
let currentClient = null;
let currentFilter = 'all';
let isLoading = true;
let scrollProgress = 0;

// Performance and animation variables
let animationId;
let particles = [];
let isReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

// ENHANCED VIDEO HANDLING FUNCTIONS - FIXED FOR YOUTUBE ERROR 153
function extractYouTubeID(url) {
  if (!url) return null;
  
  // Handle various YouTube URL formats including edge cases
  const patterns = [
    /(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/|youtube\.com\/v\/|youtube\.com\/shorts\/)([a-zA-Z0-9_-]{11})/,
    /youtube\.com\/watch\?.*v=([a-zA-Z0-9_-]{11})/,
    /youtu\.be\/([a-zA-Z0-9_-]{11})/,
    /www\.youtube\.com\/shorts\/([a-zA-Z0-9_-]{11})/,
    /m\.youtube\.com\/watch\?.*v=([a-zA-Z0-9_-]{11})/
  ];
  
  for (const pattern of patterns) {
    const match = url.match(pattern);
    if (match && match[1]) {
      return match[1];
    }
  }
  
  return null;
}

function extractVimeoID(url) {
  if (!url) return null;
  const match = url.match(/vimeo\.com\/(\d+)/);
  return match ? match[1] : null;
}

function isYouTubeShort(url) {
  return url && url.includes('/shorts/');
}

function getVideoType(videoData) {
  if (videoData.type === 'reel') return 'vertical';
  if (videoData.url && isYouTubeShort(videoData.url)) return 'vertical';
  return 'horizontal';
}

function getPlatformFromUrl(url) {
  if (!url) return 'unknown';
  if (url.includes('youtube.com') || url.includes('youtu.be')) return 'youtube';
  if (url.includes('vimeo.com')) return 'vimeo';
  if (url.includes('instagram.com')) return 'instagram';
  return 'unknown';
}

function getPlatformIcon(platform) {
  const icons = {
    'youtube': 'üì∫',
    'vimeo': 'üé¨',
    'instagram': 'üì∑'
  };
  return icons[platform] || 'üé•';
}

// ENHANCED VIDEO EMBED URL GENERATION WITH ERROR 153 FIX
function getVideoEmbedUrl(videoData) {
  const url = videoData.url;
  const platform = getPlatformFromUrl(url);
  
  if (platform === 'youtube') {
    const videoId = extractYouTubeID(url);
    if (videoId) {
      // Enhanced embed URL with parameters to bypass restrictions
      const currentDomain = window.location.hostname || 'mehdiginal.com';
      return `https://www.youtube-nocookie.com/embed/${videoId}?autoplay=0&mute=0&controls=1&origin=https://${currentDomain}&widget_referrer=https://${currentDomain}&enablejsapi=1&rel=0&modestbranding=1&fs=1&cc_load_policy=0&iv_load_policy=3&autohide=0&playsinline=1`;
    }
  } else if (platform === 'vimeo') {
    const videoId = extractVimeoID(url);
    if (videoId) {
      return `https://player.vimeo.com/video/${videoId}?badge=0&autopause=0&player_id=0&app_id=58479&dnt=1`;
    }
  }
  
  return null;
}

// ENHANCED VIDEO EMBED CREATION WITH FALLBACK HANDLING
function createVideoEmbed(videoData) {
  const primaryUrl = videoData.url;
  const videoType = getVideoType(videoData);
  const platform = getPlatformFromUrl(primaryUrl);
  const videoId = platform === 'youtube' ? extractYouTubeID(primaryUrl) : null;
  
  const container = document.createElement('div');
  container.className = `video-container ${videoType}`;
  container.style.position = 'relative';
  
  // Create video embed wrapper with fallback structure
  const embedWrapper = document.createElement('div');
  embedWrapper.className = 'video-embed-wrapper';
  embedWrapper.style.position = 'relative';
  embedWrapper.style.width = '100%';
  embedWrapper.style.height = '100%';
  
  const embedUrl = getVideoEmbedUrl(videoData);
  
  if (embedUrl) {
    // Create iframe with enhanced attributes
    const iframe = document.createElement('iframe');
    iframe.src = embedUrl;
    iframe.setAttribute('title', videoData.title);
    iframe.setAttribute('allowfullscreen', '');
    iframe.setAttribute('frameborder', '0');
    iframe.setAttribute('referrerpolicy', 'strict-origin-when-cross-origin');
    
    if (platform === 'youtube') {
      iframe.setAttribute('allow', 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share');
    } else if (platform === 'vimeo') {
      iframe.setAttribute('allow', 'autoplay; fullscreen; picture-in-picture');
    }
    
    iframe.style.width = '100%';
    iframe.style.height = '100%';
    iframe.style.borderRadius = '8px';
    iframe.style.border = 'none';
    
    // Create fallback for restricted videos
    const fallback = document.createElement('div');
    fallback.className = 'video-fallback';
    fallback.style.display = 'none';
    fallback.style.position = 'absolute';
    fallback.style.top = '0';
    fallback.style.left = '0';
    fallback.style.width = '100%';
    fallback.style.height = '100%';
    fallback.style.background = 'var(--glass-bg)';
    fallback.style.backdropFilter = 'var(--glass-blur)';
    fallback.style.borderRadius = '8px';
    fallback.style.display = 'none';
    fallback.style.flexDirection = 'column';
    fallback.style.alignItems = 'center';
    fallback.style.justifyContent = 'center';
    fallback.style.textAlign = 'center';
    fallback.style.padding = '2rem';
    
    // YouTube thumbnail fallback
    const thumbnailUrl = videoId ? `https://img.youtube.com/vi/${videoId}/maxresdefault.jpg` : '';
    
    fallback.innerHTML = `
      <a href="${primaryUrl}" target="_blank" class="play-on-youtube" style="text-decoration: none; color: white; transition: all 0.3s ease; display: flex; flex-direction: column; align-items: center;">
        ${thumbnailUrl ? `
          <div class="youtube-thumbnail" style="position: relative; margin-bottom: 1rem;">
            <img src="${thumbnailUrl}" alt="${videoData.title}" style="width: 120px; height: 90px; border-radius: 8px; object-fit: cover;">
            <div class="play-button" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(255, 0, 0, 0.8); color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 16px;">‚ñ∂</div>
          </div>
        ` : ''}
        <h4 style="margin: 0 0 0.5rem 0; font-size: 1.1rem; font-weight: 600;">${videoData.title}</h4>
        <p style="margin: 0 0 1rem 0; color: rgba(255,255,255,0.7); font-size: 0.9rem;">Click to watch on YouTube</p>
        <div style="display: inline-flex; align-items: center; gap: 8px; background: rgba(255, 0, 0, 0.8); color: white; padding: 0.75rem 1.5rem; border-radius: 0.75rem; font-weight: 500;">
          üì∫ Open on YouTube
        </div>
      </a>
    `;
    
    embedWrapper.appendChild(iframe);
    embedWrapper.appendChild(fallback);
    
    // Enhanced error handling for iframe failures
    let errorDetected = false;
    let loadTimeout;
    
    // Handle iframe load errors
    iframe.addEventListener('error', function() {
      console.log('iframe error detected for:', videoData.title);
      showFallback();
    });
    
    // Check for iframe load success/failure
    iframe.addEventListener('load', function() {
      clearTimeout(loadTimeout);
      
      // Additional check for blocked content after a delay
      setTimeout(() => {
        try {
          // Try to access iframe content (will throw error for successful embeds due to CORS)
          const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
          
          // If we can access the document, it might be an error page
          if (iframeDoc && iframeDoc.body) {
            const bodyText = iframeDoc.body.textContent || '';
            if (bodyText.includes('Video unavailable') || bodyText.includes('Error') || bodyText.includes('restricted')) {
              console.log('Video content error detected:', bodyText);
              showFallback();
            }
          }
        } catch (e) {
          // Cross-origin error is expected for successful embeds
          console.log('Cross-origin restriction (normal for working embeds)');
        }
      }, 2000);
    });
    
    // Set timeout to detect loading issues
    loadTimeout = setTimeout(() => {
      if (!errorDetected) {
        console.log('iframe load timeout for:', videoData.title);
        // Don't auto-fallback on timeout as video might still load
      }
    }, 10000);
    
    function showFallback() {
      if (errorDetected) return;
      errorDetected = true;
      
      console.log('Showing fallback for:', videoData.title);
      iframe.style.display = 'none';
      fallback.style.display = 'flex';
    }
    
  } else {
    // No valid embed URL, create direct link fallback
    embedWrapper.style.background = 'var(--glass-bg)';
    embedWrapper.style.backdropFilter = 'var(--glass-blur)';
    embedWrapper.style.borderRadius = '1rem'; 
    embedWrapper.style.padding = '2rem';
    embedWrapper.style.textAlign = 'center';
    embedWrapper.style.display = 'flex';
    embedWrapper.style.flexDirection = 'column';
    embedWrapper.style.justifyContent = 'center';
    embedWrapper.style.alignItems = 'center';
    embedWrapper.style.minHeight = '200px';
    
    const linkContent = document.createElement('div');
    linkContent.innerHTML = `
      <h4 style="margin: 0 0 1rem 0; color: white; font-size: 1.1rem; font-weight: 600;">${videoData.title}</h4>
      <p style="margin: 0 0 1.5rem 0; color: rgba(255,255,255,0.7); font-size: 0.9rem;">Click to view on ${platform}</p>
      <a href="${primaryUrl}" target="_blank" 
         style="display: inline-flex; align-items: center; gap: 8px; background: var(--gradient-primary); color: white; padding: 0.75rem 1.5rem; border-radius: 0.75rem; text-decoration: none; font-weight: 500; transition: transform 0.2s ease;">
        ${getPlatformIcon(platform)} View Video
      </a>
    `;
    embedWrapper.appendChild(linkContent);
  }
  
  container.appendChild(embedWrapper);
  
  // Platform indicator
  const platformBadge = document.createElement('div');
  platformBadge.className = `platform-badge ${platform}`;
  platformBadge.textContent = getPlatformIcon(platform);
  platformBadge.style.position = 'absolute';
  platformBadge.style.top = '12px';
  platformBadge.style.right = '12px';
  platformBadge.style.width = '28px';
  platformBadge.style.height = '28px';
  platformBadge.style.borderRadius = '50%';
  platformBadge.style.display = 'flex';
  platformBadge.style.alignItems = 'center';
  platformBadge.style.justifyContent = 'center';
  platformBadge.style.fontSize = '12px';
  platformBadge.style.color = 'white';
  platformBadge.style.zIndex = '2';
  platformBadge.style.pointerEvents = 'none';
  platformBadge.style.backdropFilter = 'blur(10px)';
  
  if (platform === 'youtube') {
    platformBadge.style.background = 'rgba(255, 0, 0, 0.9)';
  } else if (platform === 'instagram') {
    platformBadge.style.background = 'rgba(225, 48, 108, 0.9)';
  } else if (platform === 'vimeo') {
    platformBadge.style.background = 'rgba(0, 148, 255, 0.9)';
  }
  
  container.appendChild(platformBadge);
  
  // Video info overlay
  const videoInfo = document.createElement('div');
  videoInfo.className = 'video-info';
  videoInfo.style.position = 'absolute';
  videoInfo.style.bottom = '0';
  videoInfo.style.left = '0';
  videoInfo.style.right = '0';
  videoInfo.style.background = 'linear-gradient(transparent, rgba(0, 0, 0, 0.8))';
  videoInfo.style.padding = '12px';
  videoInfo.style.color = 'white';
  videoInfo.style.pointerEvents = 'none';
  
  const viewsInfo = videoData.views ? ` ‚Ä¢ ${videoData.views} views` : '';
  const engagementInfo = videoData.engagement ? ` ‚Ä¢ ${videoData.engagement} engagement` : '';
  
  videoInfo.innerHTML = `
    <h4 style="margin: 0 0 4px 0; font-size: 14px; font-weight: 500; line-height: 1.3;">${videoData.title}</h4>
    <p style="margin: 0; font-size: 12px; color: rgba(255, 255, 255, 0.8);">${videoData.type === 'reel' ? 'Reel üì±' : 'Video üì∫'}${viewsInfo}${engagementInfo}</p>
  `;
  container.appendChild(videoInfo);
  
  return container;
}

// ENHANCED IFRAME ERROR MONITORING
document.addEventListener('DOMContentLoaded', function() {
  // Global iframe error monitoring for YouTube embeds
  const checkIframeErrors = () => {
    const iframes = document.querySelectorAll('iframe[src*="youtube"]');
    
    iframes.forEach(iframe => {
      if (iframe.dataset.errorChecked) return;
      iframe.dataset.errorChecked = 'true';
      
      // Monitor for iframe load issues
      let errorCheckTimeout = setTimeout(() => {
        try {
          // Check if iframe has loaded properly
          const iframeWindow = iframe.contentWindow;
          
          // If we can't access the window or it's about:blank, there might be an issue
          if (!iframeWindow || iframeWindow.location.href === 'about:blank') {
            console.log('Potential iframe loading issue detected');
            // Don't auto-fallback as this might be normal loading behavior
          }
        } catch (e) {
          // Cross-origin error is expected for working YouTube embeds
          console.log('Cross-origin error (expected for working embeds)');
        }
      }, 5000);
      
      iframe.addEventListener('load', () => {
        clearTimeout(errorCheckTimeout);
      });
    });
  };
  
  // Check for iframe errors periodically
  setInterval(checkIframeErrors, 3000);
});

// Check if project/client has single video for sizing
function isSingleVideo(entity) {
  if (!entity.videos && !entity.items) return false;
  const videoCount = entity.videos ? entity.videos.length : entity.items.length;
  return videoCount === 1;
}

// BEFORE/AFTER SLIDER INITIALIZATION
function initBeforeAfterSlider() {
  const sliders = document.querySelectorAll('.before-after-slider');
  
  sliders.forEach(slider => {
    const handle = slider.querySelector('.slider-handle');
    const afterImage = slider.querySelector('.after-image');
    const sliderLine = slider.querySelector('.slider-line');
    
    if (!handle || !afterImage || !sliderLine) return;
    
    let isDragging = false;
    
    // Mouse events
    handle.addEventListener('mousedown', (e) => {
      e.preventDefault();
      isDragging = true;
      document.body.style.cursor = 'ew-resize';
    });
    
    document.addEventListener('mouseup', () => {
      isDragging = false;
      document.body.style.cursor = '';
    });
    
    document.addEventListener('mousemove', (e) => {
      if (!isDragging) return;
      
      const rect = slider.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const percentage = (x / rect.width) * 100;
      
      const clampedPercentage = Math.max(0, Math.min(100, percentage));
      
      afterImage.style.clipPath = `inset(0 ${100 - clampedPercentage}% 0 0)`;
      handle.style.left = `${clampedPercentage}%`;
      sliderLine.style.left = `${clampedPercentage}%`;
    });
    
    // Touch events for mobile
    handle.addEventListener('touchstart', (e) => {
      e.preventDefault();
      isDragging = true;
    });
    
    document.addEventListener('touchend', () => {
      isDragging = false;
    });
    
    document.addEventListener('touchmove', (e) => {
      if (!isDragging) return;
      
      e.preventDefault();
      const touch = e.touches[0];
      const rect = slider.getBoundingClientRect();
      const x = touch.clientX - rect.left;
      const percentage = (x / rect.width) * 100;
      
      const clampedPercentage = Math.max(0, Math.min(100, percentage));
      
      afterImage.style.clipPath = `inset(0 ${100 - clampedPercentage}% 0 0)`;
      handle.style.left = `${clampedPercentage}%`;
      sliderLine.style.left = `${clampedPercentage}%`;
    });
  });
}

// LOADING SCREEN
function initializeLoadingScreen() {
  console.log('Initializing loading screen...');
  
  const loadingScreen = document.getElementById('loading-screen');
  const progressBar = document.querySelector('.progress-bar');
  
  if (!loadingScreen || !progressBar) return;
  
  // Create loading particles
  createLoadingParticles();
  
  // Simulate loading progress
  let progress = 0;
  const loadingInterval = setInterval(() => {
    progress += Math.random() * 15;
    if (progress >= 100) {
      progress = 100;
      clearInterval(loadingInterval);
      
      setTimeout(() => {
        loadingScreen.classList.remove('active');
        isLoading = false;
        
        // Initialize main application after loading
        initializeMainApp();
      }, 500);
    }
    progressBar.style.width = `${progress}%`;
  }, 100);
}

function createLoadingParticles() {
  if (isReducedMotion) return;
  
  const particlesContainer = document.querySelector('.loading-particles');
  if (!particlesContainer) return;
  
  for (let i = 0; i < 50; i++) {
    const particle = document.createElement('div');
    particle.style.position = 'absolute';
    particle.style.width = '2px';
    particle.style.height = '2px';
    particle.style.background = '#6366f1';
    particle.style.borderRadius = '50%';
    particle.style.opacity = Math.random();
    particle.style.left = Math.random() * 100 + '%';
    particle.style.top = Math.random() * 100 + '%';
    particle.style.animation = `float ${2 + Math.random() * 3}s ease-in-out infinite`;
    particle.style.animationDelay = Math.random() * 2 + 's';
    
    particlesContainer.appendChild(particle);
  }
}

// CUSTOM CURSOR
function initializeCustomCursor() {
  if (window.innerWidth <= 768 || isReducedMotion) return;
  
  const cursor = document.querySelector('.custom-cursor');
  if (!cursor) return;
  
  let mouseX = 0, mouseY = 0;
  let cursorX = 0, cursorY = 0;
  
  document.addEventListener('mousemove', (e) => {
    mouseX = e.clientX;
    mouseY = e.clientY;
  });
  
  function animateCursor() {
    cursorX += (mouseX - cursorX) * 0.1;
    cursorY += (mouseY - cursorY) * 0.1;
    
    cursor.style.left = cursorX + 'px';
    cursor.style.top = cursorY + 'px';
    
    requestAnimationFrame(animateCursor);
  }
  
  animateCursor();
}

// THEME TOGGLE
function initializeThemeToggle() {
  const themeToggle = document.querySelector('.theme-toggle');
  if (!themeToggle) return;
  
  const currentTheme = localStorage.getItem('theme') || 'dark';
  document.documentElement.setAttribute('data-color-scheme', currentTheme);
  
  themeToggle.addEventListener('click', () => {
    const currentTheme = document.documentElement.getAttribute('data-color-scheme');
    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
    
    document.documentElement.setAttribute('data-color-scheme', newTheme);
    localStorage.setItem('theme', newTheme);
    
    const themeIcon = themeToggle.querySelector('.theme-icon');
    themeIcon.textContent = newTheme === 'dark' ? 'üåì' : '‚òÄÔ∏è';
  });
}

// SCROLL PROGRESS
function initializeScrollProgress() {
  const progressFill = document.querySelector('.progress-fill');
  if (!progressFill) return;
  
  function updateScrollProgress() {
    const scrollTop = window.pageYOffset;
    const docHeight = document.documentElement.scrollHeight - window.innerHeight;
    const progress = (scrollTop / docHeight) * 100;
    
    progressFill.style.width = `${Math.min(progress, 100)}%`;
    scrollProgress = progress;
  }
  
  window.addEventListener('scroll', updateScrollProgress, { passive: true });
  updateScrollProgress();
}

// ENHANCED NAVIGATION WITH PROPER EVENT HANDLING
function initializeNavigation() {
  console.log('Initializing navigation...');
  
  // Handle nav link clicks
  document.querySelectorAll('.nav-link, .mobile-nav-link').forEach(link => {
    link.addEventListener('click', function(e) {
      e.preventDefault();
      const href = this.getAttribute('href');
      if (href) {
        const targetView = href.substring(1);
        navigateToView(targetView);
        closeMobileMenu();
      }
    });
  });

  // Handle logo clicks
  document.querySelectorAll('.logo').forEach(logo => {
    logo.addEventListener('click', function(e) {
      e.preventDefault();
      navigateToView('home');
    });
  });

  // Handle back button
  const backBtn = document.getElementById('back-to-projects');
  if (backBtn) {
    backBtn.addEventListener('click', function(e) {
      e.preventDefault();
      navigateToView('projects');
    });
  }

  // Handle project card clicks with event delegation
  document.addEventListener('click', function(e) {
    const projectCard = e.target.closest('.project-showcase-card, .project-card');
    if (projectCard) {
      e.preventDefault();
      const projectId = projectCard.dataset.projectId;
      if (projectId) {
        console.log('Project card clicked:', projectId);
        showProjectDetail(projectId);
      }
      return;
    }

    // Handle client card clicks
    const clientCard = e.target.closest('.client-showcase-card');
    if (clientCard) {
      e.preventDefault();
      const clientName = clientCard.querySelector('.client-showcase-name')?.textContent;
      if (clientName) {
        const client = appData.clients.find(c => c.name === clientName);
        if (client) {
          console.log('Client card clicked:', client.name);
          navigateToView('clients');
          setTimeout(() => showClientContent(client), 200);
        }
      }
      return;
    }
  });
}

function navigateToView(viewName) {
  console.log('Navigating to view:', viewName);
  
  const views = document.querySelectorAll('.view');
  const navLinks = document.querySelectorAll('.nav-link, .mobile-nav-link');
  
  // Hide all views
  views.forEach(view => {
    view.classList.remove('active');
  });
  
  // Show target view
  const targetView = document.getElementById(`${viewName}-view`);
  if (targetView) {
    targetView.classList.add('active');
    currentView = viewName;
    
    // Update active nav link
    navLinks.forEach(link => {
      link.classList.remove('active');
      const linkHref = link.getAttribute('href');
      if (linkHref === `#${viewName}`) {
        link.classList.add('active');
      }
    });
    
    // Scroll to top
    window.scrollTo({ top: 0, behavior: 'smooth' });
    
    // Re-initialize animations for new view
    setTimeout(() => {
      initializeScrollAnimations();
      if (viewName === 'skills') {
        animateSkillBars();
      }
    }, 100);
  }
}

// MOBILE MENU WITH PROPER FUNCTIONALITY
function initializeMobileMenu() {
  const mobileMenuBtn = document.querySelector('.mobile-menu-btn');
  const mobileMenu = document.querySelector('.mobile-menu');
  const mobileMenuClose = document.querySelector('.mobile-menu-close');
  
  if (!mobileMenuBtn || !mobileMenu) return;
  
  function openMobileMenu() {
    mobileMenu.classList.add('active');
    mobileMenuBtn.classList.add('active');
    document.body.style.overflow = 'hidden';
  }
  
  function closeMobileMenu() {
    mobileMenu.classList.remove('active');
    mobileMenuBtn.classList.remove('active');
    document.body.style.overflow = '';
  }
  
  mobileMenuBtn.addEventListener('click', openMobileMenu);
  
  if (mobileMenuClose) {
    mobileMenuClose.addEventListener('click', closeMobileMenu);
  }
  
  // Close menu when clicking outside
  mobileMenu.addEventListener('click', function(e) {
    if (e.target === mobileMenu) {
      closeMobileMenu();
    }
  });
  
  // Make function globally available
  window.closeMobileMenu = closeMobileMenu;
}

// HERO PARTICLES
function initializeHeroParticles() {
  if (isReducedMotion) return;
  
  const particlesContainer = document.getElementById('hero-particles');
  if (!particlesContainer) return;
  
  const particleCount = window.innerWidth > 768 ? 100 : 50;  
  
  for (let i = 0; i < particleCount; i++) {
    createParticle(particlesContainer);
  }
  
  function animateParticles() {
    particles.forEach(particle => {
      particle.y += particle.speed;
      particle.x += Math.sin(particle.y * 0.01) * 0.5;
      
      if (particle.y > window.innerHeight) {
        particle.y = -10;
        particle.x = Math.random() * window.innerWidth;
      }
      
      particle.element.style.transform = `translate(${particle.x}px, ${particle.y}px)`;
      particle.element.style.opacity = particle.opacity;
    });
    
    if (!isReducedMotion) {
      requestAnimationFrame(animateParticles);
    }
  }
  
  animateParticles();
}

function createParticle(container) {
  const particle = document.createElement('div');
  particle.style.position = 'absolute';
  particle.style.width = Math.random() * 3 + 1 + 'px';
  particle.style.height = particle.style.width;
  particle.style.background = '#6366f1';
  particle.style.borderRadius = '50%';
  particle.style.pointerEvents = 'none';
  
  const particleData = {
    element: particle,
    x: Math.random() * window.innerWidth,
    y: Math.random() * window.innerHeight,
    speed: Math.random() * 2 + 0.5,
    opacity: Math.random() * 0.5 + 0.2
  };
  
  particles.push(particleData);
  container.appendChild(particle);
}

// FALLBACK IMAGES
function createFallbackProjectImage(title, category) {
  return `data:image/svg+xml;base64,${btoa(`
    <svg width="400" height="300" viewBox="0 0 400 300" fill="none" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <linearGradient id="grad" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" style="stop-color:#6366f1;stop-opacity:1" />
          <stop offset="100%" style="stop-color:#8b5cf6;stop-opacity:1" />
        </linearGradient>
      </defs>
      <rect width="400" height="300" fill="url(#grad)" rx="20"/>
      <circle cx="200" cy="120" r="30" fill="rgba(255,255,255,0.2)"/>
      <path d="M185 110 L185 130 L210 120 Z" fill="white"/>
      <text x="200" y="170" text-anchor="middle" fill="white" font-size="20" font-weight="bold">${title}</text>
      <text x="200" y="195" text-anchor="middle" fill="rgba(255,255,255,0.8)" font-size="16">${category}</text>
    </svg>
  `)}`;
}

function createFallbackClientAvatar(name) {
  const initials = name.split(' ').map(word => word[0]).join('').toUpperCase();
  return `data:image/svg+xml;base64,${btoa(`
    <svg width="120" height="120" viewBox="0 0 120 120" fill="none" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <linearGradient id="grad" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" style="stop-color:#6366f1;stop-opacity:1" />
          <stop offset="100%" style="stop-color:#8b5cf6;stop-opacity:1" />
        </linearGradient>
      </defs>
      <circle cx="60" cy="60" r="60" fill="url(#grad)"/>
      <text x="60" y="68" text-anchor="middle" fill="white" font-size="28" font-weight="bold">${initials}</text>
    </svg>
  `)}`;
}

// LOAD FEATURED PROJECTS - ALL 4 PROJECTS SHOWN
function loadFeaturedProjects() {
  const container = document.getElementById('featured-projects-showcase');
  if (!container) return;

  container.innerHTML = '';
  
  // Show all 4 projects in featured section
  const projectsToShow = appData.projects.slice(0, 4);
  
  projectsToShow.forEach((project, index) => {
    const projectCard = createProjectShowcaseCard(project, index);
    container.appendChild(projectCard);
  });
}

function createProjectShowcaseCard(project, index = 0) {
  const card = document.createElement('div');
  const isFeatured = project.id === 'motion-graphics-collection';
  card.className = `project-showcase-card glass-card animate-fade-up${isFeatured ? ' featured' : ''}`;
  card.style.cursor = 'pointer';
  card.style.animationDelay = `${index * 0.2}s`;
  card.dataset.projectId = project.id;
  
  const fallbackImage = createFallbackProjectImage(project.title, project.category);
  
  card.innerHTML = `
    <img src="${project.cover}" alt="${project.title}" class="project-showcase-image" onerror="this.src='${fallbackImage}'" loading="lazy">
    <div class="project-showcase-overlay">
      <div class="project-showcase-category">${project.category}</div>
      <h3 class="project-showcase-title">${project.title}</h3>
      <p class="project-showcase-description">${project.description || 'Click to explore this amazing project'}</p>
    </div>
  `;
  
  return card;
}

// LOAD ALL PROJECTS
function loadAllProjects() {
  const container = document.getElementById('all-projects-grid');
  if (!container) return;

  container.innerHTML = '';
  
  appData.projects.forEach((project, index) => {
    const projectCard = createProjectCard(project, index);
    container.appendChild(projectCard);
  });
}

function createProjectCard(project, index = 0) {
  const card = document.createElement('div');
  const isMotionGraphics = project.category.toLowerCase().includes('motion graphics');
  const hasSingleVideo = isSingleVideo(project);
  
  card.className = `project-card glass-card animate-fade-up${isMotionGraphics ? ' motion-graphics' : ''}${hasSingleVideo ? ' single-video' : ''}`;
  card.style.cursor = 'pointer';
  card.style.animationDelay = `${index * 0.1}s`;
  card.dataset.projectId = project.id;
  
  const fallbackImage = createFallbackProjectImage(project.title, project.category);
  
  card.innerHTML = `
    <img src="${project.cover}" alt="${project.title}" class="project-image" onerror="this.src='${fallbackImage}'" loading="lazy">
    <div class="project-overlay">
      <h3 class="project-title">${project.title}</h3>
      <p class="project-category">${project.category}</p>
      <div class="project-stats">
        <span class="project-videos">${project.videos.length} video${project.videos.length === 1 ? '' : 's'}</span>
        <span class="project-year">${project.year}</span>
      </div>
    </div>
  `;
  
  return card;
}

// PROJECT DETAIL FUNCTION
function showProjectDetail(projectId) {
  const project = appData.projects.find(p => p.id === projectId);
  if (!project) return;

  currentProject = project;
  const container = document.getElementById('project-detail-content');
  const fallbackImage = createFallbackProjectImage(project.title, project.category);
  
  const clientName = project.client?.name || 'Self';
  
  // Create before/after section if it exists
  const beforeAfterSection = project.beforeAfter ? `
    <div class="before-after-section">
      <h3 class="section-title">Before & After</h3>
      <p class="section-subtitle">See the transformation and impact of our creative work</p>
      <div class="before-after-slider">
        <div class="slider-container">
          <img src="${project.beforeAfter.before}" alt="Before" class="before-image" loading="lazy">
          <img src="${project.beforeAfter.after}" alt="After" class="after-image" loading="lazy">
          <div class="slider-handle"></div>
          <div class="slider-line"></div>
        </div>
      </div>
    </div>
  ` : '';
  
  container.innerHTML = `
    <div class="project-detail-hero">
      <img src="${project.cover}" alt="${project.title}" class="project-detail-image" onerror="this.src='${fallbackImage}'" loading="lazy">
      <div class="project-detail-info">
        <h1 class="page-title gradient-text">${project.title}</h1>
        <p class="project-detail-description">${project.description}</p>
        <div class="project-meta glass-card">
          <div class="meta-row">
            <div class="meta-item">
              <strong>Category</strong>
              <span>${project.category}</span>
            </div>
            <div class="meta-item">
              <strong>Client</strong>
              <span>${clientName}</span>
            </div>
            <div class="meta-item">
              <strong>Duration</strong>
              <span>${project.duration}</span>
            </div>
            <div class="meta-item">
              <strong>Year</strong>
              <span>${project.year}</span>
            </div>
          </div>
          ${project.tags ? `
            <div class="project-tags">
              ${project.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
            </div>
          ` : ''}
        </div>
        ${project.results ? `
          <div class="project-results glass-card">
            <h3>Results Achieved</h3>
            <div class="results-grid">
              ${Object.entries(project.results).map(([key, value]) => `
                <div class="result-item">
                  <span class="result-value">${value}</span>
                  <span class="result-label">${key.replace('_', ' ')}</span>
                </div>
              `).join('')}
            </div>
          </div>
        ` : ''}
      </div>
    </div>
    ${beforeAfterSection}
    <div class="project-videos">
      <h2 class="section-title">Project Videos</h2>
      <p class="section-subtitle">Watch the complete video collection - now with enhanced embedding and fallback support</p>
      <div class="videos-grid" id="project-videos-grid">
      </div>
    </div>
    ${project.testimonial ? `
      <div class="project-testimonial glass-card">
        <div class="testimonial-icon">üí¨</div>
        <p>"${project.testimonial}"</p>
      </div>
    ` : ''}
  `;
  
  // Add video embeds
  const videosGrid = container.querySelector('#project-videos-grid');
  project.videos.forEach((video, index) => {
    const videoEmbed = createVideoEmbed(video);
    videoEmbed.style.animationDelay = `${index * 0.1}s`;
    videoEmbed.classList.add('animate-fade-up');
    videosGrid.appendChild(videoEmbed);
  });
  
  // Initialize before/after slider if present
  if (project.beforeAfter) {
    setTimeout(() => {
      initBeforeAfterSlider();
    }, 100);
  }
  
  navigateToView('project-detail');
  window.history.pushState({}, '', `#project-${projectId}`);
}

// CLIENT SHOWCASE
function loadClientsPreview() {
  const container = document.getElementById('clients-preview-showcase');
  if (!container) return;

  container.innerHTML = '';
  
  appData.clients.forEach((client, index) => {
    const clientCard = createClientShowcaseCard(client, index);
    container.appendChild(clientCard);
  });
}

function createClientShowcaseCard(client, index = 0) {
  const card = document.createElement('div');
  const hasSingleVideo = isSingleVideo(client);
  
  card.className = `client-showcase-card animate-fade-up${hasSingleVideo ? ' single-video' : ''}`;
  card.style.cursor = 'pointer';
  card.style.animationDelay = `${index * 0.1}s`;
  
  const fallbackAvatar = createFallbackClientAvatar(client.name);
  
  const statsEntries = client.stats ? Object.entries(client.stats).slice(0, 3) : [];
  const statsHTML = statsEntries.map(([key, value]) => `
    <div class="client-stat">
      <span class="client-stat-value">${value}</span>
      <span class="client-stat-label">${key.replace('_', ' ')}</span>
    </div>
  `).join('');
  
  card.innerHTML = `
    <img src="${client.avatar}" alt="${client.name}" class="client-showcase-avatar" onerror="this.src='${fallbackAvatar}'" loading="lazy">
    <h3 class="client-showcase-name">${client.name}</h3>
    <div class="client-showcase-stats">
      ${statsHTML}
    </div>
  `;
  
  return card;
}

// CLIENTS LIST
function loadClientsList() {
  const container = document.getElementById('clients-list');
  if (!container) return;

  container.innerHTML = '';
  
  appData.clients.forEach(client => {
    const clientItem = createClientListItem(client);
    container.appendChild(clientItem);
  });
}

function createClientListItem(client) {
  const item = document.createElement('div');
  item.className = 'client-list-item';
  item.dataset.clientId = client.id;
  item.style.cursor = 'pointer';
  
  const fallbackAvatar = createFallbackClientAvatar(client.name);
  
  const statsText = client.stats ? 
    Object.values(client.stats).slice(0, 2).join(' ‚Ä¢ ') : 
    'Premium Content Creator';
  
  item.innerHTML = `
    <img src="${client.avatar}" alt="${client.name}" class="client-list-avatar" onerror="this.src='${fallbackAvatar}'" loading="lazy">
    <div class="client-list-info">
      <h3>${client.name}</h3>
      <div class="client-list-stats">${statsText}</div>
    </div>
  `;
  
  item.addEventListener('click', () => {
    console.log('Client list item clicked:', client.name);
    showClientContent(client);
  });
  
  return item;
}

// CLIENT CONTENT DISPLAY WITH PROPER VIDEO GRID SIZING
function showClientContent(client) {
  console.log('Showing client content:', client.name);
  currentClient = client;
  const contentArea = document.getElementById('clients-content-area');
  const fallbackAvatar = createFallbackClientAvatar(client.name);
  
  // Update active state
  document.querySelectorAll('.client-list-item').forEach(item => {
    item.classList.remove('active');
    if (item.dataset.clientId === client.id) {
      item.classList.add('active');
    }
  });
  
  contentArea.innerHTML = `
    <div class="client-content-header">
      <img src="${client.avatar}" alt="${client.name}" class="client-content-avatar" onerror="this.src='${fallbackAvatar}'" loading="lazy">
      <div class="client-content-info">
        <h2>${client.name}</h2>
        <p class="client-industry">${client.industry || 'Content Creator'}</p>
        ${client.stats ? `
          <div class="client-content-stats">
            ${Object.entries(client.stats).map(([key, value]) => `
              <div class="stat-item">
                <span class="stat-value">${value}</span>
                <span class="stat-label">${key.replace('_', ' ')}</span>
              </div>
            `).join('')}
          </div>
        ` : ''}
      </div>
    </div>
    ${client.testimonial ? `
      <div class="project-testimonial glass-card">
        <div class="testimonial-icon">üí¨</div>
        <p>"${client.testimonial}"</p>
      </div>
    ` : ''}
    ${client.items && client.items.length > 0 ? `
      <div class="client-work">
        <h3>Work Portfolio</h3>
        <p>Enhanced video embedding with Error 153 fixes and fallback support for all platforms</p>
        <div class="videos-grid" id="client-videos-grid">
        </div>
      </div>
    ` : '<div class="no-content glass-card"><p>Content portfolio coming soon...</p></div>'}
  `;
  
  // Add video embeds with enhanced error handling
  if (client.items && client.items.length > 0) {
    const videosGrid = contentArea.querySelector('#client-videos-grid');
    if (videosGrid) {
      client.items.forEach((item, index) => {
        const videoEmbed = createVideoEmbed(item);
        videoEmbed.style.animationDelay = `${index * 0.1}s`;
        videoEmbed.classList.add('animate-fade-up');
        videosGrid.appendChild(videoEmbed);
      });
    }
  }
  
  setTimeout(() => {
    initializeScrollAnimations();
  }, 100);
}

// PROJECT FILTERING
function initializeProjectFilters() {
  const filterButtons = document.querySelectorAll('.filter-btn');
  
  if (!filterButtons.length) return;
  
  filterButtons.forEach(button => {
    button.addEventListener('click', () => {
      const filter = button.getAttribute('data-filter');
      
      // Update active filter button
      filterButtons.forEach(btn => btn.classList.remove('active'));
      button.classList.add('active');
      
      // Filter projects
      filterProjects(filter);
      currentFilter = filter;
    });
  });
}

function filterProjects(filter) {
  const projectCards = document.querySelectorAll('#all-projects-grid .project-card');
  
  projectCards.forEach(card => {
    const project = appData.projects.find(p => p.id === card.dataset.projectId);
    
    if (filter === 'all' || 
        (project && project.category.toLowerCase().includes(filter.toLowerCase())) ||
        (project && project.tags && project.tags.some(tag => tag.toLowerCase().includes(filter.toLowerCase())))) {
      card.style.display = 'block';
      card.classList.add('animate-fade-up');
    } else {
      card.style.display = 'none';
    }
  });
}

// SKILL ANIMATIONS
function animateSkillBars() {
  const skillBars = document.querySelectorAll('.skill-bar');
  
  skillBars.forEach((bar, index) => {
    const level = bar.getAttribute('data-level');
    
    setTimeout(() => {
      bar.style.setProperty('--skill-width', `${level}%`);
      bar.classList.add('animate');
    }, index * 200);
  });
}

// COUNTER ANIMATIONS
function initializeCounters() {
  const counters = document.querySelectorAll('.counter, .stat-number');
  
  const observerCallback = (entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        const counter = entry.target;
        const target = parseInt(counter.getAttribute('data-target'));
        if (target && !counter.classList.contains('animated')) {
          counter.classList.add('animated');
          animateCounter(counter, target);
        }
        observer.unobserve(counter);
      }
    });
  };
  
  const observer = new IntersectionObserver(observerCallback, {
    threshold: 0.5
  });
  
  counters.forEach(counter => {
    observer.observe(counter);
  });
}

function animateCounter(element, target) {
  let current = 0;
  const increment = target / 60;
  const duration = 2000;
  const stepTime = duration / 60;
  
  const timer = setInterval(() => {
    current += increment;
    if (current >= target) {
      element.textContent = target;
      clearInterval(timer);
    } else {
      element.textContent = Math.floor(current);
    }
  }, stepTime);
}

// SCROLL ANIMATIONS
function initializeScrollAnimations() {
  const animateElements = document.querySelectorAll('.animate-fade-up, .animate-fade-in');
  
  const observerCallback = (entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.classList.add('in-view');
      }
    });
  };
  
  const observer = new IntersectionObserver(observerCallback, {
    threshold: 0.1,
    rootMargin: '0px 0px -50px 0px'
  });
  
  animateElements.forEach(element => {
    observer.observe(element);
  });
}

// CONTACT FORM
function initializeContactForm() {
  const contactForm = document.getElementById('contact-form');
  if (!contactForm) return;
  
  contactForm.addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const submitBtn = contactForm.querySelector('button[type="submit"]');
    const originalText = submitBtn.innerHTML;
    submitBtn.innerHTML = '<span>Sending...</span>';
    submitBtn.disabled = true;
    
    try {
      await new Promise(resolve => setTimeout(resolve, 2000));
      
      showFormMessage('Thank you! Your message has been sent successfully.', 'success');
      contactForm.reset();
      
      submitBtn.innerHTML = '<span>‚úì Message Sent!</span>';
      setTimeout(() => {
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
      }, 3000);
      
    } catch (error) {
      showFormMessage('Sorry, there was an error. Please try again.', 'error');
      submitBtn.innerHTML = originalText;
      submitBtn.disabled = false;
    }
  });
}

function showFormMessage(message, type) {
  const existingMessage = document.querySelector('.form-message');
  if (existingMessage) {
    existingMessage.remove();
  }
  
  const messageElement = document.createElement('div');
  messageElement.className = `form-message ${type}`;
  messageElement.style.padding = '1rem';
  messageElement.style.borderRadius = '0.5rem';
  messageElement.style.marginTop = '1rem';
  messageElement.style.fontWeight = '500';
  
  if (type === 'success') {
    messageElement.style.background = 'rgba(16, 185, 129, 0.1)';
    messageElement.style.color = '#10b981';
    messageElement.style.border = '1px solid rgba(16, 185, 129, 0.3)';
  } else {
    messageElement.style.background = 'rgba(239, 68, 68, 0.1)';
    messageElement.style.color = '#ef4444';
    messageElement.style.border = '1px solid rgba(239, 68, 68, 0.3)';
  }
  
  messageElement.textContent = message;
  
  const form = document.getElementById('contact-form');
  form.appendChild(messageElement);
  
  setTimeout(() => {
    if (messageElement.parentNode) {
      messageElement.remove();
    }
  }, 5000);
}

// ROUTE HANDLING
function handleInitialRoute() {
  const hash = window.location.hash.substring(1);
  if (hash) {
    if (hash.startsWith('project-')) {
      const projectId = hash.replace('project-', '');
      showProjectDetail(projectId);
    } else {
      navigateToView(hash);
    }
  }
}

// MAIN APPLICATION INITIALIZATION
function initializeMainApp() {
  console.log('Initializing main application with enhanced YouTube embedding...');
  
  // Core functionality
  initializeNavigation();
  initializeMobileMenu();
  
  // Enhanced features
  initializeCustomCursor();
  initializeThemeToggle();
  initializeScrollProgress();
  initializeHeroParticles();
  
  // Content loading
  loadFeaturedProjects();
  loadClientsPreview();
  loadAllProjects();
  loadClientsList();
  
  // Animations and interactions
  initializeCounters();
  initializeScrollAnimations();
  initializeProjectFilters();
  initializeContactForm();
  
  // Handle initial route
  handleInitialRoute();
  
  console.log('Main application initialized successfully with YouTube Error 153 fixes');
}

// DOM LOADED EVENT
document.addEventListener('DOMContentLoaded', function() {
  console.log('DOM loaded, starting initialization...');
  
  // Start with loading screen
  initializeLoadingScreen();
  
  // Fallback initialization
  setTimeout(() => {
    if (isLoading) {
      console.log('Loading screen timeout, initializing app...');
      const loadingScreen = document.getElementById('loading-screen');
      if (loadingScreen) {
        loadingScreen.classList.remove('active');
      }
      isLoading = false;
      initializeMainApp();
    }
  }, 5000);
});

// BROWSER NAVIGATION
window.addEventListener('popstate', function(e) {
  const hash = window.location.hash.substring(1);
  if (hash) {
    if (hash.startsWith('project-')) {
      const projectId = hash.replace('project-', '');
      showProjectDetail(projectId);
    } else {
      navigateToView(hash);
    }
  } else {
    navigateToView('home');
  }
});

// WINDOW RESIZE
let resizeTimeout;
window.addEventListener('resize', function() {
  clearTimeout(resizeTimeout);
  resizeTimeout = setTimeout(() => {
    // Reinitialize cursor on desktop
    if (window.innerWidth <= 768) {
      const cursor = document.querySelector('.custom-cursor');
      if (cursor) cursor.style.display = 'none';
    } else {
      const cursor = document.querySelector('.custom-cursor');
      if (cursor) cursor.style.display = 'block';
    }
    
    // Update particles
    if (particles.length > 0) {
      particles.forEach(particle => {
        if (particle.x > window.innerWidth) {
          particle.x = Math.random() * window.innerWidth;
        }
      });
    }
  }, 250);
});

// GLOBAL FUNCTIONS
window.showProjectDetail = showProjectDetail;
window.showClientContent = showClientContent;
window.navigateToView = navigateToView;